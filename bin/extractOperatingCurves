#!/usr/bin/env python
#####ros related imports
import rospy 
import cv2
import time


from dataset.utils import Directories
from front_end.utils import *
from front_end.srv import *
from front_end.msg import frameDetection,ProcTime,kPoint

from front_end.features import plotFeatures,getBestSettings,getFeatureSummary



from cv_bridge import CvBridge
import matplotlib.pyplot as plt
import matplotlib.style as sty
import pickle
import argparse
cvb=CvBridge() 

parser =argparse.ArgumentParser()
parser.add_argument("rootDir")
parser.add_argument("loopID")
parser.add_argument("detector")
args=parser.parse_args()

projectFolder=Directories(args.rootDir)
pickleDir=projectFolder.getFeaturePickle(args.loopID,args.detector)

print("loading Data from "+pickleDir)
inputPickle=open(pickleDir,"rb")
dataIn=pickle.load(inputPickle)
inputPickle.close()
print("Data Loaded")


OperatingCurves=getFeatureSummary(dataIn)
sett=getBestSettings(dataIn)
outputSettings={}
outputSettings["name"]=dataIn["detectorName"]
outputSettings["operatingCurves"]=sett


print(len(sett["Maximum"]))
print(len(sett.keys()))
print(sett["Maximum"])
outputFileName=projectFolder.getCurvePickle(args.loopID,args.detector)
print(outputFileName)
pickle.dump(outputSettings,open(outputFileName,"w"))
